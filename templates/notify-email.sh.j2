#!/bin/bash
# =============================================================================
# Email Notification Script
# =============================================================================

set -euo pipefail

source /opt/mongodb-alerting/alerting.conf

SEVERITY="$1"
MESSAGE="$2"
DETAILS="${3:-No additional details}"
TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
HOSTNAME=$(hostname -f)

SUBJECT="[MongoDB ${SEVERITY^^}] ${MESSAGE}"

BODY=$(cat << EOF
MongoDB Alert Notification
==========================

Severity: ${SEVERITY}
Host: ${HOSTNAME}
Timestamp: ${TIMESTAMP}

Message:
${MESSAGE}

Details:
${DETAILS}

--
MongoDB Alerting System
EOF
)

echo "${BODY}" | mail -s "${SUBJECT}" "${ALERT_EMAIL}"

exit 0
